---
import { getCollection } from 'astro:content';

const publications = await getCollection('publications', ({ data }) => !data.draft);
publications.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const recentPublications = publications.slice(0, 3);

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
};
---

<section id="publications-cta">
  <div class="container">
    <h2 data-animate="left">Writing</h2>
    <div class="publications-cta-wrapper glass" data-animate="scale" data-delay="1">
      <div class="cta-content">
        <p>
          Case studies and insights from building production AI systems.
        </p>
        <a href="/publications" class="btn btn-primary">
          View All Publications
          <span class="btn-arrow">â†’</span>
        </a>
      </div>
      <div class="recent-publications" data-animate="right" data-delay="2">
        {recentPublications.map((pub) => (
          <a
            href={pub.data.externalUrl || `/publications/${pub.slug}`}
            target={pub.data.externalUrl ? "_blank" : undefined}
            rel={pub.data.externalUrl ? "noopener" : undefined}
            class="recent-pub"
          >
            <span class="pub-date">{formatDate(pub.data.date)}</span>
            <span class="pub-title">{pub.data.title}</span>
          </a>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
  #publications-cta {
    padding: 5rem 0;
  }
  .publications-cta-wrapper {
    margin-top: 2rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    padding: 2.5rem;
    align-items: center;
  }
  @media (max-width: 768px) {
    .publications-cta-wrapper {
      grid-template-columns: 1fr;
      gap: 2rem;
      text-align: center;
    }
  }
  .cta-content p {
    font-size: 1rem;
    margin-bottom: 1.5rem;
    max-width: 320px;
  }
  @media (max-width: 768px) {
    .cta-content p {
      max-width: none;
    }
  }
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }
  .btn-arrow {
    transition: transform 0.2s;
  }
  .btn:hover .btn-arrow {
    transform: translateX(4px);
  }
  .recent-publications {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  .recent-pub {
    display: flex;
    align-items: baseline;
    gap: 1rem;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.04);
    transition: all 0.2s;
    text-decoration: none;
  }
  .recent-pub:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(37, 99, 235, 0.3);
    transform: translateX(4px);
  }
  .pub-date {
    font-size: 0.75rem;
    color: #6b7280;
    white-space: nowrap;
    min-width: 70px;
  }
  .pub-title {
    font-size: 0.9rem;
    color: #a0a0b0;
    transition: color 0.2s;
    line-height: 1.4;
  }
  .recent-pub:hover .pub-title {
    color: #fff;
  }
</style>
